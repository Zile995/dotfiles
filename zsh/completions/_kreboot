#compdef kreboot

_kreboot() {
  if (( CURRENT == 2 )); then
    compadd $(find /usr/lib/modules/* \
      -mindepth 1 -maxdepth 1 \
      ! -path '*/\.*' ! -path '*/build' -type f -name 'pkgbase' \
      -exec sh -c 'if pacman -Qqo -- "$0" > /dev/null 2>&1; then cat "$0"; fi;' {} \; | \
      sort -n)
  fi
}
